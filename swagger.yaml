openapi: 3.0.0
info:
  title: API Inmobiliaria INDES
  description: Documentación de los endpoints para gestión de Lotes, Usuarios y Autenticación
  version: "1.0.0"

servers:
  - url: http://localhost:3000/api
    description: Servidor local de desarrollo

tags:
  - name: Lotes
    description: Endpoints para gestión de propiedades
  - name: Usuarios
    description: Endpoints para gestión de usuarios
  - name: Autenticación
    description: Endpoints para login, verificación 2FA y recuperación de contraseña
  - name: Ubicaciones
    description: Endpoints para obtener Estados, Ciudades y Colonias
  - name: Clientes
    description: Endpoints para gestión de clientes
  - name: Contratos
    description: Endpoints para gestión de contratos de venta
  - name: Pagos
    description: Endpoints para gestión de pagos

paths:
  # =========================
  # Lotes
  # =========================
  /lotes:
    get:
      tags: [Lotes]
      summary: Obtener todos los lotes
      responses:
        "200":
          description: Lista de lotes
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  lotes:
                    type: array
                    items:
                      $ref: "#/components/schemas/Lote"
    post:
      tags: [Lotes]
      summary: Crear un nuevo lote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Lote"
      responses:
        "201":
          description: Lote creado exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  lote:
                    $ref: "#/components/schemas/Lote"
        "400":
          description: Error al crear lote

  /lotes/buscar:
    post:
      tags: [Lotes]
      summary: Buscar lote usando JSON
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tipo:
                  type: string
                  enum: [casa, depto, terreno, local, otro]
                numLote:
                  type: string
                  nullable: true
                manzana:
                  type: string
                  nullable: true
                direccion:
                  type: string
                  nullable: true
      responses:
        "200":
          description: Lote encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  lotes:
                    type: array
                    items:
                      $ref: "#/components/schemas/Lote"
        "404":
          description: Lote no encontrado

  /lotes/actualizar:
    put:
      tags: [Lotes]
      summary: Actualizar lote usando JSON
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filtro:
                  type: object
                  properties:
                    tipo:
                      type: string
                    numLote:
                      type: string
                      nullable: true
                    manzana:
                      type: string
                      nullable: true
                    direccion:
                      type: string
                      nullable: true
                datos:
                  $ref: "#/components/schemas/Lote"
      responses:
        "200":
          description: Lote actualizado
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  lote:
                    $ref: "#/components/schemas/Lote"
        "404":
          description: Lote no encontrado

  /lotes/eliminar:
    delete:
      tags: [Lotes]
      summary: Eliminar lote usando JSON
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tipo:
                  type: string
                numLote:
                  type: string
                  nullable: true
                manzana:
                  type: string
                  nullable: true
                direccion:
                  type: string
                  nullable: true
      responses:
        "200":
          description: Lote eliminado
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  lote:
                    $ref: "#/components/schemas/Lote"
        "404":
          description: Lote no encontrado

  # =========================
  # Usuarios
  # =========================
  /users:
    get:
      tags: [Usuarios]
      summary: Obtener usuarios filtrando por JSON
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                rol:
                  type: string
      responses:
        "200":
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
    post:
      tags: [Usuarios]
      summary: Crear un nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses:
        "201":
          description: Usuario creado
        "400":
          description: Error de validación

  /users/actualizar:
    put:
      tags: [Usuarios]
      summary: Actualizar usuario usando JSON
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                datos:
                  $ref: "#/components/schemas/User"
      responses:
        "200":
          description: Usuario actualizado
    delete:
      tags: [Usuarios]
      summary: Eliminar usuario usando JSON
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
      responses:
        "200":
          description: Usuario eliminado

  # =========================
  # Autenticación
  # =========================
  /auth/login:
    post:
      tags: [Autenticación]
      summary: Inicia sesión con correo y contraseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - correo
                - password
              properties:
                correo:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: OTP enviado al correo
        "400":
          description: Error de validación

  /auth/verify-otp:
    post:
      tags: [Autenticación]
      summary: Verifica el código OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - correo
                - otp
              properties:
                correo:
                  type: string
                otp:
                  type: string
      responses:
        "200":
          description: Autenticación completada

  /auth/send-reset:
    post:
      tags: [Autenticación]
      summary: Enviar enlace de recuperación de contraseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - correo
              properties:
                correo:
                  type: string
      responses:
        "200":
          description: Enlace enviado

  /auth/reset:
    post:
      tags: [Autenticación]
      summary: Restablecer la contraseña usando token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                password:
                  type: string

components:
  schemas:
    Lote:
      type: object
      properties:
        tipo:
          type: string
          enum: [casa, depto, terreno, local, otro]
        numLote:
          type: string
        manzana:
          type: string
          nullable: true
        direccion:
          type: string
        id_colonia:
          type: integer
          nullable: true
        id_ciudad:
          type: integer
          nullable: true
        id_estado:
          type: integer
          nullable: true
        codigo_postal:
          type: string
          nullable: true
        nombre_colonia_nueva:
          type: string
          nullable: true
        superficie_m2:
          type: number
        precio:
          type: number
        valor_avaluo:
          type: number
          nullable: true
        num_habitaciones:
          type: integer
          nullable: true
        num_banos:
          type: integer
          nullable: true
        num_estacionamientos:
          type: integer
          nullable: true
        servicios:
          type: string
          nullable: true
        descripcion:
          type: string
          nullable: true
        topografia:
          type: string
          nullable: true
        documentacion:
          type: string
          nullable: true
        estado_propiedad:
          type: string
          enum: [disponible, rentada, vendida, en proceso]
        fecha_disponibilidad:
          type: string
          format: date
          nullable: true
        imagen:
          type: string
          nullable: true
        id_user:
          type: integer
          nullable: true

    User:
      type: object
      properties:
        usuario:
          type: string
        password:
          type: string
        rol:
          type: string
          enum: [admin, vendedor, cliente, dueño, secretaria]
        correo:
          type: string
        telefono:
          type: string
          description: Debe tener 10 dígitos
